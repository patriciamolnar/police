"use strict";$(document).ready(function(){var e=(new Date).getFullYear(),a=[];a.push(e);for(var t=1;t<=3;t++)a.push(e-t);$.each(a,function(e,a){$("#year").append($("<option>",{value:a,text:a}))}),$(document.body).keydown(function(e){"Tab"===e.key&&document.documentElement.classList.remove("no-focus-outline")});var n=["#669ccc","#ffcc33","#264F73"],o={"Controlled drugs":'<span class="label-title">Controlled Drugs</span>&nbsp;refer to prescription drugs listed in the Misuse of Drugs Act 1971. Such drugs include for example: Cocaine, LSD and Morphine.<br/>You can see the most common one\'s on gov.uk\'s<a href="https://www.gov.uk/government/publications/controlled-drugs-list--2/list-of-most-commonly-encountered-drugs-currently-controlled-under-the-misuse-of-drugs-legislation" target="_blank">List of commonly encountered drugs</a>',"Offensive weapons":'<span class="label-title">Offensive weapons</span>&nbsp;are objects that have been made or adapted with the intetion to cause injury to another individual, either by the carrier or by someone else. A few examples are: a conceiled knife, pepper spray and a knuckle duster. ',"Criminal damage":'<span class="label-title">Criminal Damage</span>&nbsp;relates to an individual damaging or wanting to damage property belonging to another person without any right to do so, either by intent or recklessness.',"Threatening conduct":'<span class="label-title">Threatening conduct:</span>&nbsp;any behaviour that is intended to threaten or cause harm an individual.',"Article for use in theft":'<span class="label-title">Article for use in theft:</span>&nbsp;any object that has been used or adapted for use in theft.',"Stolen goods":'<span class="label-title">Stolen goods:</span>&nbsp;possession of property that has been dishonestly taken from another person, without the intent of returning it.',Other:'<span class="label-title">Other:</span>&nbsp; Reason was not specified.'},s=$("#mapContainer"),r=$("#infoContainer"),l=$("#postcode"),i=$("#error");l.on({blur:function(){var e=/^[A-Z]{1,2}[0-9]{1,2}[A-Z]{0,1}[0-9]{1,2}[A-Z]{2}$/i,a=$(this).val().replace(/\s/g,"");a.match(e)&&(l.removeClass("error"),l.removeClass("error-border"),i.html(""));a.match(e)||(l.addClass("error"),l.addClass("error-border"),i.html("<span class='background'><span class='exclaim'>!</span> Invalid postcode</span>"))}});var d=$("button");function c(){" "!=s.html()&&s.html("")," "!=r.html()&&r.html("").css("padding-bottom","0");var e="https://api.postcodes.io/postcodes/"+$("input").val().replace(/\s/g,"");$.ajax({url:e,contentType:"application/json",dataType:"json",success:function(e){var a=e.result.longitude;!function(e,a){var e=e,a=a,t=$("#month").val(),c=$("#year").val(),p="https://data.police.uk/api/stops-street?lat="+e+"&lng="+a+"&date="+c+"-"+t;$.ajax({url:p,type:"GET",dataType:"json",success:function(e){if(0===e.length)l.addClass("error"),l.addClass("error-border"),i.html("<span class='background'><span class='exclaim'>!</span> There is no data for your postcode</span>"),d.blur();else{l.removeClass("error"),l.removeClass("error-border"),i.html("");var a=[];$.each(e,function(e,t){a[e]=[t.object_of_search,t.outcome_object.name]}),function(e){var a=[[],[],[],[]];if($.each(e,function(e,t){-1===$.inArray(t[0],a[0])&&(a[0][a[0].length]=t[0],a[1][a[1].length]=0,a[2][a[2].length]=0,a[3][a[3].length]=0)}),$.each(e,function(e,t){var n=$.inArray(t[0],a[0]);a[1][n]++,/arrest/i.test(t[1])&&a[2][n]++,/arrest/i.test(t[1])||/no further action/i.test(t[1])||a[3][n]++}),-1!=a[0].indexOf("Evidence of offences under the Act")){var t=a[0].indexOf("Evidence of offences under the Act"),l=a[0].indexOf("Stolen goods");a[0].splice(t,1);var i=a[1][t];a[1][l]+=i;var c=a[2][t];a[2][l]+=c;var p=a[3][t];a[3][l]+=p,a[1].splice(t,1),a[2].splice(t,1),a[3].splice(t,1)}$.each(a[0],function(e,t){null==t&&(a[0][e]="Other"),"Firearms"===t&&(a[0][e]="Guns"),"Anything to threaten or harm anyone"===t&&(a[0][e]="Threatening conduct"),"Articles for use in criminal damage"===t&&(a[0][e]="Criminal damage"),"Goods on which duty has not been paid etc."===t&&(a[0][e]="Duty not paid")}),$.each(a[0],function(e,t){a[0][e]=t.split(" ")}),function(e){var a=e;s.html("");var t=$("<canvas></canvas>");window.innerWidth<900&&(t[0].height=500);var l=t[0].getContext("2d"),i=(new Chart(l,{type:"horizontalBar",data:{labels:a[0],datasets:[{label:"# of Stop and Searches",data:a[1],backgroundColor:n[0],borderWidth:1},{label:"# of Arrests",data:a[2],backgroundColor:n[1],borderWidth:1},{label:"# of Other resolutions**",data:a[3],backgroundColor:n[2],borderWidth:1}]},options:{legend:{labels:{fontColor:"#d9d9d9",fontFamily:"Tahoma"}},scales:{yAxes:[{ticks:{fontColor:"#d9d9d9",fontFamily:"Tahoma",fontSize:"12"}}],xAxes:[{ticks:{fontColor:"#d9d9d9",fontFamily:"Tahoma",fontSize:"12",maxRotation:0,minRotation:0}}]}}}),$('<div><h1 class="heading" style="width:250px;">Your results</h1></div>').addClass("header"));s.append(i),s.append(t);var c=$('<div><p class="other-resolution">**Other resolutions could be amongst others: a warning, summons or a <a href="https://www.askthe.police.uk/content/Q760.htm" target="_blank">community resolution</a></p></div>');s.append(c),function(e){var a=e;r.html("").css("padding-bottom","0");var t=[];$.each(a[0],function(e,a){t[e]=a.join(" ")}),$.each(t,function(e,t){var s=$("<div></div>").addClass("infoDiv"),l="";o[t]&&(l=o[t]);var i='<p class="title">'+t+'</p><p><span class="square" style="background-color:'+n[0]+'"></span>&nbspNumber of Stops and Searches: '+a[1][e]+'</p><p><span class="square" style="background-color:'+n[1]+'"></span>&nbspNumber of Arrest:  '+a[2][e]+'</p><p><span class="square" style="background-color:'+n[2]+'"></span>&nbspNumber of Other Resolutions: '+a[3][e]+'</p><p class="description">'+l+"</p>";s.html(i),r.append(s).css("padding-bottom","2rem")})}(a),d.blur()}(a)}(a)}},error:function(e){l.addClass("error"),l.addClass("error-border"),i.html("<span class='background'><span class='exclaim'>!</span> No result for your selected date. Data is only available for 3 years with a 2 month delay.</span>"),d.blur()}})}(e.result.latitude,a)},error:function(e){l.addClass("error"),l.addClass("error-border"),i.html("<span class='background'><span class='exclaim'>!</span> Invalid postcode</span>"),d.blur()}})}d.on({click:c},{tap:c})});